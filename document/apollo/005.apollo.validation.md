# 孤城暗雪：验证

>  青海长云暗雪山，孤城遥望玉门关。——王昌龄《从军行七首·其四》

* 项目地址：<https://github.com/silentbalanceyh/vertx-zero-example/>（子项目：**up-apollo**）

##  「壹」JSR303

&ensp;&ensp;&ensp;&ensp;本章我们进入Zero中的另外一大亮点——对JSR303的支持；JSR303是Java EE 6开始出现的一项子规范，又称为[Bean Validation](https://jcp.org/en/jsr/detail?id=303)，它提供了后端执行请求校验的基本规范，而常用的一个该规范的实现就是`Hibernate Validator`，Zero中则使用了它来实现该规范，并且对之进行了深度扩展。

&ensp;&ensp;&ensp;&ensp;接下来的讲解中，我们将忽略控制台中大部分输出，而关注**异常响应**部分来看Zero中对JSR部分的支持。Zero对JSR303支持的使用场景如下：

1. JSR303可以在Zero中的Agent组件中使用。
2. JSR303可以在`interface`风格的Agent组件使用。
3. JSR303可以应用于EventBus中的Worker组件。
4. 扩展了JSR303过后，Zero可针对Json结构的数据进行验证（配合yaml配置文件）。

>  在Zero中一个标准的Verticle组件分两种：Agent组件和Worker组件，后续章节会逐步讲解异步模式下的开发，让读者逐渐了解这两种组件。

&ensp;&ensp;&ensp;&ensp;关于Zero中对JSR303的部分有两个限制：

1. 在对Json结构的数据执行验证时，验证的数据规范和`zero-ui`前端一致，一方面可以和它无缝集成，另外一方面可以独立使用。
2. JSR303在执行Json结构数据验证时，需配合`yml`格式的接口描述文件执行验证定义描述。

### 1.1. JSR303注解

&ensp;&ensp;&ensp;&ensp;JSR303中的注解如下：

>  注解位于包`javax.validation.constraints`中。

|注解名|说明|
|:---|:---|
|@Null|注释的元素必须为null。|
|@NotNull|注释的元素必须不为null。|
|@AssertTrue|注释的元素必须是true。|
|@AssertFalse|注释的元素必须是false。|
|@Min(value)|被注释的元素必须是一个数字，其值必须大于等于指定的最小值。|
|@Max(value)|被注释的元素必须是一个数字，其值必须小于等于指定的最大值。|
|@DecimalMin(value)|被注释的元素必须是一个数字，其值必须大于等于指定的最小值。|
|@DecimalMax(value)|被注释的元素必须是一个数字，其值必须小于等于指定的最大值。|
|@Size(max,min)|被注释的元素大小必须在指定的范围内。|
|@Digits(integer,fraction)|被注释的元素必须是数值，且精度是可接受的范围。|
|@Past|被注释的元素必须是一个过去的时间。|
|@Future|被注释的元素必须是一个将来的时间。|
|@Pattern(value)|被注释的元素必须符合指定的正则表达式。|

### 1.2. JSR303示例


