# 鼚乎：Shell

> 卿云烂兮，乣缦缦兮。日月光华，旦复旦兮。明明上天，烂然星陈。日月光华，弘于一人。日月有常，星辰有行。——佚名《卿云歌》

* 项目地址：<https://github.com/silentbalanceyh/vertx-zero-example/>（子项目：**up-shell**）

&ensp;&ensp;&ensp;&ensp;本章节是主要讲解Zero中的其中一个插件`zero-ifx-shell`，它可以帮助您很快书写想要的Shell可交互式命令行，借助Vert.x中的DevOps部分，您可以很快书写Zero中的第二程序入口用来帮助开发和调试。我们在产品版本中书写了一个统一入口，部署到生产环境时可根据不同命令参数启动Zero容器。

|启动命令|含义|
|:---|:---|
|start|启动Zero容器。|
|config|生产环境初始化配置。|
|config dev|开发环境初始化配置。|

## 「壹」自动化工具

### 1.1. Out-Of-Box

&ensp;&ensp;&ensp;&ensp;前文中多次提到了OOB，那么什么是OOB？OOB的全称是`Out-Of-Box`，您可以将这个理解成**开箱标准数据**——即当你系统第一次在生产环境发布时的初始化数据，这些数据包括**配置数据**、**基础数据**、**账号数据**、**环境数据**等一切支撑系统运行的数据，如果您开发的系统具有业务标准化的一面，可能还会携带标准化过后的业务数据如分类、组织架构、界面配置等等。

&ensp;&ensp;&ensp;&ensp;我写的不是代码么，为什么运行还依赖数据呢？这个问题不好回答，您可以思考一个场景：假设您设计了订单系统，订单中有一个属性叫做市场来源，最初的时候您就设计了两到三种市场来源，那时候够用，但随着系统的扩大，您通常会面临开发一个市场来源管理的基础数据模块——一旦这个模块成型，那么在最初发布系统时，您的代码变成了数据，就自然面临基础数据导入的功能。也许有人会说：我可以将数据录入系统！没错，你的确可以这样做，但如果市场来源数据不是两三条，而是上百条或者上千条呢，若您没有自动化工具去完成这些操作，系统部署将会成为您的噩梦。

&ensp;&ensp;&ensp;&ensp;于是在系统部署之前，您最好可以做到：

1. 准备一种人工容易编辑的OOB格式（Zero中用Excel和Json混合）。
2. 准备一种可直接导入数据的方式（本章的Shell配合Excel插件）。

&ensp;&ensp;&ensp;&ensp;有了如此准备，OOB数据就可以直接被导入到系统中了，若您启用了**唯一标识**，还可以让整个导入过程没有任何副作用（可反复运行维持只有一份数据），目前Zero的导入模块就是这样做的。

### 1.2. Shell

&ensp;&ensp;&ensp;&ensp;写交互式命令行在每个项目中都是应该存在的，因为它提供了一种**沉默**的方式让你对系统执行各种操作，所以Zero提供了两种方式执行命令：

|执行方式|含义|
|:---|:---|
|zero-ifx-shell|编写和项目直接相关的交互式命令行程序。|
|zero ai|在线地址：http://www.vertxai.cn，NodeJs书写的独立命令。|

&ensp;&ensp;&ensp;&ensp;本章主要学习第一种模式，如何在Zero项目中书写自己的命令行工具，作为一个命令行框架，让你减少部分写命令行的工作量：

1. 不让开发人员写命令的基础判断。
2. 不让开发人员检查命令的输入规范。
3. 不让开发人员设置环境相关信息。

&ensp;&ensp;&ensp;&ensp;归根到底，就是直接让开发人员书写命令的执行程序，越简单越直接越暴力越好。在Zero中写命令行程序需先在Maven中添加以下片段引入该项目：

```xml
    <dependency>
        <groupId>cn.vertxup</groupId>
        <artifactId>zero-ifx-shell</artifactId>
    </dependency>
```

## 「壹」实战分析

